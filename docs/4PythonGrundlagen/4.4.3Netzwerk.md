# 4.4.3 Netzwerk-Ein-/Ausgabe (Webserver, HTTP)

| Ein- und Ausgabebefehle     | Beschreibung                                                   |
|------------|----------------------------------------------------------------|
| [`recv()`](https://docs.python.org/3/library/socket.html#socket.socket.recv)   | Empf√§ngt Daten √ºber das Netzwerk (z.B. von einem Webclient).    |
| [`send()`](https://docs.python.org/3/library/socket.html#socket.socket.send)   | Sendet Daten √ºber das Netzwerk (z.B. an einen Webclient).       |



## üì° Eingabe und Ausgabe √ºber das Netzwerk

Der Pi Pico kann Daten √ºber das Netzwerk empfangen und senden, wenn er als Webserver oder Client verwendet wird. Dies erm√∂glicht beispielsweise die Fernsteuerung √ºber einen Webbrowser.

### Einfaches Beispiel: Daten √ºber das Netzwerk empfangen und verarbeiten

Hier simulieren wir eine einfache Server-Client-Interaktion, bei der der Pi Pico als Server fungiert und Daten von einem Webclient (Browser) empf√§ngt.

```python linenums="1"
# Webserver zur Steuerung einer LED am Pi Pico
# J. Thomaschewski, 04.09.2024
import network
import socket
import time

# WLAN-Zugangsdaten
SSID = 'Ihr_WLAN_Name'
PASSWORD = 'Ihr_WLAN_Passwort'

# WLAN verbinden
wlan = network.WLAN(network.STA_IF)
wlan.active(True)
wlan.connect(SSID, PASSWORD)

# Warten, bis das WLAN verbunden ist
while not wlan.isconnected():
    print("Verbindung zum WLAN wird hergestellt...")
    time.sleep(1)

print(f"WLAN verbunden: {wlan.ifconfig()}")

# Webserver starten
addr = socket.getaddrinfo('0.0.0.0', 80)[0][-1]
server = socket.socket()
server.bind(addr)
server.listen(1)
print(f"Listening on {addr}")

# Server wartet auf Verbindungen
while True:
    client, client_addr = server.accept()
    print(f"Client verbunden von {client_addr}")

    # Daten vom Client empfangen
    request = client.recv(1024)
    print(f"Request: {request}")

    # Antwort an den Client senden
    response = "HTTP/1.1 200 OK\r\nContent-Type: text/html\r\n\r\nHallo von Pi Pico!"
    client.send(response)
    client.close()
```

In diesem Beispiel fungiert der Pi Pico als einfacher Webserver, der Anfragen von einem Browser entgegennimmt und darauf antwortet. Dies zeigt, wie der Pi Pico Daten aus dem Netzwerk empfangen und verarbeiten kann.

!!! info "So f√ºhren Sie das Beispiel aus"

    Damit dieses Beispiel funktioniert, muss Ihr Pi Pico W √ºber WLAN verbunden sein. Die einfachste Methode daf√ºr ist es, das eigene **Smartphone als WLAN-Hotspot** zu verwenden:

    ### Schritt-f√ºr-Schritt-Anleitung

    1. **Hotspot am Smartphone aktivieren**

        - √ñffnen Sie die Einstellungen auf Ihrem Smartphone.
        - Suchen Sie den Men√ºpunkt **‚ÄûMobiler Hotspot‚Äú** oder **‚ÄûPers√∂nlicher Hotspot‚Äú**.
        - Aktivieren Sie den Hotspot und vergeben Sie einen **Netzwerknamen (SSID)** und ein **sicheres Passwort**.

    2. **Zugangsdaten im Programm eintragen**

        - Ersetzen Sie im Quelltext die Platzhalter:
        ```python
        SSID = 'Ihr_WLAN_Name'       # z.‚ÄØB. "iPhone von Lisa"
        PASSWORD = 'Ihr_WLAN_Passwort'
        ```
        durch die tats√§chlichen Zugangsdaten Ihres Hotspots.

    3. **Programm auf den Pi Pico √ºbertragen**

        - Starten Sie Thonny.
        - Verbinden Sie Ihren Pi Pico W mit dem Computer.
        - √úbertragen Sie den Code auf den Pico und f√ºhren Sie ihn aus.

    4. **IP-Adresse merken**

        - Sobald die Verbindung erfolgreich ist, gibt das Programm die IP-Adresse Ihres Pi Pico W im Terminal aus:
        ```text
        WLAN verbunden: ('192.168.123.45', '255.255.255.0', ...)
        ```

    5. **Im Browser auf dem Smartphone aufrufen**

        - √ñffnen Sie den Webbrowser auf **dem Smartphone**, das den Hotspot bereitstellt.
        - Geben Sie die angezeigte IP-Adresse in die Adresszeile ein (z.‚ÄØB. `http://192.168.123.45`).
        - Sie sollten nun die Nachricht **‚ÄûHallo von Pi Pico!‚Äú** im Browser sehen.


    Diese Vorgehensweise funktioniert am zuverl√§ssigsten, da sowohl der Pi Pico W als auch das Smartphone im selben Netzwerk sind ‚Äì ganz ohne WLAN-Router.


### Besseres Beispiel: Daten √ºber das Netzwerk empfangen und verarbeiten

```python linenums="1"
# Webserver zur Steuerung einer LED am Pi Pico
# J. Thomaschewski, 04.09.2024
import network
import socket
from machine import Pin

# LED-Pin definieren
led = Pin('LED', Pin.OUT)

# WLAN verbinden
wlan = network.WLAN(network.STA_IF)
wlan.active(True)
wlan.connect('WLAN-SSID', 'WLAN-PASSWORD')

# Warten auf die Verbindung
while not wlan.isconnected():
    pass

print('Netzwerkverbindung hergestellt')
print('IP-Adresse:', wlan.ifconfig()[0])

# Server starten
addr = socket.getaddrinfo('0.0.0.0', 80)[0][-1]
server = socket.socket()
server.bind(addr)
server.listen(1)
print(f"Listening on {addr}")

# Server l√§uft und wartet auf Anfragen
while True:
    client, client_addr = server.accept()
    print(f"Client verbunden von {client_addr}")
    
    # Anfrage vom Client empfangen
    request = client.recv(1024)
    request = str(request)
    print(f"Request: {request}")
    
    # LED ein- oder ausschalten basierend auf der Anfrage
    if '/led_on' in request:
        led.on()
        response = "LED ist AN"
    elif '/led_off' in request:
        led.off()
        response = "LED ist AUS"
    else:
        response = "Unbekannter Befehl"

    # Antwort an den Client senden
    client.send("HTTP/1.1 200 OK\r\n")
    client.send("Content-Type: text/html\r\n\r\n")
    client.send("<html><body><h1>{}</h1></body></html>".format(response))
    client.close()
```

!!! question "Versuchen Sie das Beispiel zu verstehen"

    Analysieren Sie den Sourcecode und versuchen Sie das Beispiel zu verstehen, bevor Sie es installieren.
